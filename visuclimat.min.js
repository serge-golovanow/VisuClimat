/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  
 * VisuClimat : visualisez les changements environnementaux de la Terre
 * Copyright (c) 2018, Serge Golovanow <serge@sendell.com>
 * 
 * Requiert les librairies suivantes :
 *  jQuery                  Licence MIT     (c) JS Foundation and other contributors  |  http://jquery.org/license
 *  jquery.dynamic-url      Licence MIT     Copyrighted 2013 by Toni Almeida, promatik.
 *  jquery.touchSwipe       Licence MIT     Copyright (c) 2010-2015 Matt Bryson
 *  Cocoen                  Licence MIT     (c) Koen Romers
 * 
 * version 2018-05-27
 * 
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */

"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if("value"in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)};function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}jQuery(document).ready(function(a){function c(s){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500,u=void 0,v=void 0;u=o[s][0],v=o[s][1];var w=elems[u].images[v];p!=s&&(p=s),a("div.btelem.actif").removeClass("actif"),a("img.fondu").length&&(a("div#cocoen").stop(!0),a("img#avant, img#apres").remove(),a("img#avant2:first").stop(!0).attr("id","avant").removeClass("fondu"),a("img#apres2:first").stop(!0).off("load").attr("id","apres").removeClass("fondu"),a("img.fondu").length&&(console.info("Il reste des \xE9l\xE9ments .fondu : "+a(".fondu")),a(".fondu").remove())),a(document.createElement("img")).hide().attr("id","avant2").attr("alt","Image VisuClimat").addClass("fondu cocoimg").attr("src",basedir+w.avant).appendTo("#wrapper"),a(document.createElement("img")).hide().attr("id","apres2").attr("alt","Image VisuClimat").addClass("fondu cocoimg").attr("src",basedir+w.apres).appendTo("#cocoen"),a("html").addClass("wait"),a("img#apres2").on("load",function(){a("html").removeClass("wait");try{var z;a.loadURL(),z=a.getVars().image,z!=s&&a.pushVar("image",s,"",!0)}catch(A){console.warn("Erreur du pushVar : "+A)}var x=a(this).get(0).naturalHeight,y=a(this).get(0).naturalWidth;x*=1350/y,x=Math.floor(x),document.title="VisuClimat : "+w.lieu.replace(/<[^>]+>/g,""),a("h2#titre").html(w.titre),a("div#legende").html(w.legende),a("div#credit").html("<p>"+w.credit+"</p>"),a("div#avant-date").html(w["avant-date"]),a("div#apres-date").html(w["apres-date"]),a("div#btelem-"+s).addClass("actif"),a("img.fondu").fadeIn(t),a("div#cocoen").stop(!0).animate({height:x},t,function(){a("img#avant, img#apres").remove(),a("img#avant2:first").attr("id","avant").removeClass("fondu"),a("img#apres2:first").attr("id","apres").removeClass("fondu"),a("img.fondu").remove()})})}function f(s){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500;1!==a("div#theme-"+s).length||a("div#theme-"+s).hasClass("ouvert")||a("div.theme.ouvert div.theme-images, div#theme-images-"+s).stop(!0).slideToggle(t).parent().toggleClass("ouvert")}function g(){return!!(p<o.length-1)&&(p++,f(o[p][0]),c(p),!0)}function h(){return!!(0<p)&&(p--,f(o[p][0]),c(p),!0)}function k(){a(".cocoen-drag").addClass("noSwipe"),a("body").swipe({swipeLeft:function swipeLeft(s){a(s.target).hasClass("cocoimg")||"cocoen-drag"==s.target.className||g()},swipeRight:function swipeRight(s){a(s.target).hasClass("cocoimg")||"cocoen-drag"==s.target.className||h()},swipeDown:function swipeDown(){h()},swipeUp:function swipeUp(){g()},fingers:"all",threshold:75,maxTimeThreshold:500})}function l(){var s=100;document.body.addEventListener("wheel",function(t){!1==t.ctrlKey&&0<t.deltaY&&p<o.length-1&&Date.now()-q>s&&(q=Date.now(),g()),!1==t.ctrlKey&&1>t.deltaY&&0<p&&Date.now()-q>s&&(q=Date.now(),h())},{passive:!0})}function m(){a(document).on("keyup",function(s){84==s.which&&a("html").toggleClass("tactile")}),a(document).on("keyup",function(s){0<=a.inArray(s.which,[33,37,38])&&h()}),a(document).on("keyup",function(s){0<=a.inArray(s.which,[34,39,40])&&g()}),a(document).on("keyup",function(s){36==s.which&&(p=0,c(p),f(o[p][0]))}),a(document).on("keyup",function(s){35==s.which&&(p=o.length-1,c(p),f(o[p][0]))}),a(document).on("keyup",function(s){97<=s.which&&105>=s.which&&(n.leftPos=169*(s.which-97)+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){49==s.which&&(f(1),p=10,c(p),n.leftPos=673+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){50==s.which&&(n.leftPos=845+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){51==s.which&&(n.leftPos=30+n.elementOffsetLeft,n.drag())}),a(document).on("keydown",function(s){if(52==s.which)return!1}),a(document).on("keyup",function(s){52==s.which&&(n.leftPos=1330+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){53==s.which&&f(2)}),a(document).on("keyup",function(s){54==s.which&&(n.leftPos=1330+n.elementOffsetLeft,n.drag(),f(2),p=20,c(p))}),a(document).on("keyup",function(s){55==s.which&&(n.leftPos=1014+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){56==s.which&&(n.leftPos=170+n.elementOffsetLeft,n.drag())}),a(document).on("keyup",function(s){57==s.which&&(n.leftPos=1330+n.elementOffsetLeft,n.drag(),a("html").removeClass("tactile"))}),a(document).on("keyup",function(s){if(48==s.which)for(var _loop=function(t){setTimeout(function(){f(t)},1500*t)};5>i;i++)_loop(0)})}var n,r=function(s){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,s),_createClass(t,[{key:"createElements",value:function createElements(){if(1!==a("div#cocoen.cocoen").length)throw new DOMException("Il faut UN \xE9l\xE9ment &lt;div id=\"cocoen\" class=\"cocoen\"&gt; !!");if(2!==a("div#cocoen.cocoen>img#avant.cocoimg , div#cocoen.cocoen>img#apres.cocoimg").length)throw new DOMException("Il faut des images &lt;img id=\"avant\" class=\"cocoimg\"&gt; et &lt;img id=\"apres\" class=\"cocoimg\"&gt; !!");try{_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"createElements",this).call(this)}catch(u){throw console.error(u),new DOMException("Impossible d'initialiser les \xE9l\xE9ments : "+u)}a(".cocoen>div:first-child").attr("id","wrapper"),a("#avant-date").detach().appendTo("#wrapper")}},{key:"onDragEnd",value:function onDragEnd(u){this.isDragging?this.isDragging=!1:a(u.target).hasClass("cocoimg")&&_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onTap",this).call(this,u)}},{key:"addEventListeners",value:function addEventListeners(){this.element.addEventListener("mousemove",this.onDrag.bind(this)),this.element.addEventListener("touchmove",this.onDrag.bind(this),{passive:!1}),this.dragElement.addEventListener("mousedown",this.onDragStart.bind(this)),this.dragElement.addEventListener("touchstart",this.onDragStart.bind(this),{passive:!1}),window.addEventListener("mouseup",this.onDragEnd.bind(this)),window.addEventListener("resize",this.dimensions.bind(this))}},{key:"dimensions",value:function dimensions(){var u=10;_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dimensions",this).call(this),this.minLeftPos=this.elementOffsetLeft+u,this.maxLeftPos=this.elementOffsetLeft+this.elementWidth-this.dragElementWidth-u}},{key:"drag",value:function drag(){this.leftPos<this.minLeftPos?this.leftPos=this.minLeftPos:this.leftPos>this.maxLeftPos&&(this.leftPos=this.maxLeftPos);var u=this.isDragging?0:1500,x=this.leftPos+this.dragElementWidth/2-this.elementOffsetLeft;x/=this.elementWidth;var y=100*x+"%",v=this.beforeElement.style.width;""==v&&(v="50");var w=Math.abs(parseFloat(y)-parseFloat(v))/100;w+=(1-w)/4,u*=w,a(this.options.dragElementSelector).stop(!0).animate({left:y},u),a("#wrapper").stop(!0).animate({width:y},u),this.options.dragCallback&&this.options.dragCallback(x)}}]),t}(Cocoen),o=[],p=0,q=0;if(o=function(){for(var v,s=0,t=[],u=0;u<elems.length;u++){v=elems[u],a(document.createElement("div")).addClass("theme").attr("id","theme-"+u).attr("data-theme-id",u).appendTo("#liste"),a(document.createElement("h3")).html(v.theme).appendTo("#theme-"+u),a(document.createElement("div")).addClass("theme-images").attr("id","theme-images-"+u).hide().appendTo("#theme-"+u);for(var x,w=0;w<v.images.length;w++)x=v.images[w],a(document.createElement("div")).addClass("btelem").attr("data-id",s).attr("id","btelem-"+s).html(x.lieu).appendTo("#theme-images-"+u),t[s++]=[u,w]}return a(document.createElement("div")).attr("id","info").html("<p style='cursor:help;'>Choisissez un th\xE8me et un lieu, ou "+(tactile?"balayez verticalement l'\xE9cran":"utilisez la molette de souris")+" pour naviguer parmi les "+t.length+" images. &nbsp; D\xE9placez le curseur vertical ou cliquez sur l'image pour comparer avant/apr\xE8s.</p>").appendTo("#liste"),a(document.createElement("div")).attr("id","credit").html("").appendTo("#liste"),a(document.createElement("hr")).appendTo("#liste"),a(document.createElement("p")).attr("id","auteur").html("Par <a href=\"https://www.sendell.com/blog/visualisation-des-changements-environnementaux\">Serge Golovanow</a>").appendTo("#liste"),a("div.theme h3").on("click",function(){f(a(this).parent().attr("data-theme-id"))}),a("div.theme div.btelem").on("click",function(){var y=a(this).attr("data-id");y!=p&&(p=y,c(p))}),t}(),!o.length)throw new Error("Erreur au chargement de la configuration, apparemment pas d'images pr\xE9sentes");else a("#legende").html("Chargement de la premi\xE8re image en cours");p=function(){var s;try{s=a.getVars().image,s=RegExp(/^[0-9]+$/).test(s)&&s<o.length?parseInt(s):pardefaut}catch(t){s=pardefaut,console.warn("Erreur pour r\xE9cup\xE9rer l'image depuis l'URL : "+t)}try{a.onPopState(function(){a.loadURL(),s=a.getVars().image,c(s),f(o[s][0])})}catch(t){console.warn("Erreur pour g\xE9rer pr\xE9c\xE9dent/suivant : "+t)}try{a(document).bind("contextmenu click",function(t){(3==t.which||2==t.which)&&(console.log(t),t.preventDefault(),a(t.target).triggerHandler("click",t))})}catch(t){console.warn("Erreur pour g\xE9rer le clic droit/du milieu : "+t)}return window.ondragstart=function(){return!1},k(),l(),devmode&&(a("body").addClass("devmode"),a("html").addClass("devmode")),tactile&&a("html").addClass("tactile"),m(),a("#info").dblclick(function(){screenfull.enabled&&screenfull.request()}),"undefined"!=typeof n&&n.dimensions(),s}();try{n=new r}catch(s){throw a("#titre").html("Erreur \xE0 l'initialisation de Cocoen : "+s),new Error("Erreur \xE0 l'initialisation de Cocoen : "+s)}f(o[p][0],0),c(p,0)});

